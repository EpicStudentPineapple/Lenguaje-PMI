<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registrarse - Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../CSS/Registro.css">
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <div class="auth-container">
        <div class="auth-card">
            <div class="brand-logo">
                <i class="fas fa-user-plus"></i>
            </div>
            
            <h1 class="auth-title">Crear Cuenta</h1>
            <p class="auth-subtitle">Completa la información para registrarte</p>
            
            <div class="success-message" id="successMessage">
                <i class="fas fa-check-circle"></i> ¡Cuenta creada exitosamente! Serás redirigido al login...
            </div>
            
            <form id="registerForm" novalidate>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="firstName">Nombre</label>
                        <div class="input-group">
                            <i class="fas fa-user input-icon"></i>
                            <input type="text" id="firstName" class="form-input" placeholder="Tu nombre" required>
                        </div>
                        <div class="error-message" id="firstName-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="lastName">Apellido</label>
                        <div class="input-group">
                            <i class="fas fa-user input-icon"></i>
                            <input type="text" id="lastName" class="form-input" placeholder="Tu apellido" required>
                        </div>
                        <div class="error-message" id="lastName-error"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="email">Correo Electrónico</label>
                    <div class="input-group">
                        <i class="fas fa-envelope input-icon"></i>
                        <input type="email" id="email" class="form-input" placeholder="email" required>
                    </div>
                    <div class="error-message" id="email-error"></div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="phone">Teléfono</label>
                        <div class="input-group">
                            <i class="fas fa-phone input-icon"></i>
                            <input type="tel" id="phone" class="form-input" placeholder="+1234567890">
                        </div>
                        <div class="error-message" id="phone-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="role">Rol</label>
                        <select id="role" class="form-select" required>
                            <option value="">Seleccionar rol</option>
                            <option value="student">Estudiante</option>
                            <option value="teacher">Profesor</option>
                            <option value="admin">Administrador</option>
                        </select>
                        <div class="error-message" id="role-error"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="password">Contraseña</label>
                    <div class="input-group">
                        <i class="fas fa-lock input-icon"></i>
                        <input type="password" id="password" class="form-input" placeholder="contraseña" required>
                        <button type="button" class="password-toggle" onclick="togglePassword('password', 'password-icon')">
                            <i class="fas fa-eye" id="password-icon"></i>
                        </button>
                    </div>
                    <div class="password-strength">
                        <div class="strength-bar">
                            <div class="strength-fill" id="strength-fill"></div>
                        </div>
                        <div class="strength-text" id="strength-text">Ingresa una contraseña</div>
                    </div>
                    <div class="password-requirements" id="passwordRequirements" style="display: none;">
                        <div class="requirement" id="req-length">
                            <i class="fas fa-times"></i>
                            Al menos 8 caracteres
                        </div>
                        <div class="requirement" id="req-lowercase">
                            <i class="fas fa-times"></i>
                            Una letra minúscula
                        </div>
                        <div class="requirement" id="req-uppercase">
                            <i class="fas fa-times"></i>
                            Una letra mayúscula
                        </div>
                        <div class="requirement" id="req-number">
                            <i class="fas fa-times"></i>
                            Un número
                        </div>
                        <div class="requirement" id="req-special">
                            <i class="fas fa-times"></i>
                            Un carácter especial
                        </div>
                    </div>
                    <div class="error-message" id="password-error"></div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="confirmPassword">Confirmar Contraseña</label>
                    <div class="input-group">
                        <i class="fas fa-lock input-icon"></i>
                        <input type="password" id="confirmPassword" class="form-input" placeholder="contraseña" required>
                        <button type="button" class="password-toggle" onclick="togglePassword('confirmPassword', 'confirm-password-icon')">
                            <i class="fas fa-eye" id="confirm-password-icon"></i>
                        </button>
                    </div>
                    <div class="error-message" id="confirmPassword-error"></div>
                </div>
                
                <div class="terms-checkbox">
                    <input type="checkbox" id="terms" required>
                    <div class="terms-text">
                        Al registrarte, aceptas nuestros <a href="#" onclick="openModal('terms')">Términos de Servicio</a> y <a href="#" onclick="openModal('privacy')">Política de Privacidad</a>. También aceptas recibir comunicaciones por email, las cuales puedes cancelar en cualquier momento.
                    </div>
                </div>
                <div class="error-message" id="terms-error"></div>
                
                <button type="submit" class="btn-primary" id="register-btn">
                    <i class="fas fa-spinner spinner"></i>
                    Crear Cuenta
                </button>
            </form>
            
            <div class="auth-divider">
                <span>o regístrate con</span>
            </div>
            
            <div class="social-login">
                <a href="#" class="social-btn" onclick="socialLogin('google')">
                    <i class="fab fa-google"></i>
                    Google
                </a>
                <a href="#" class="social-btn" onclick="socialLogin('microsoft')">
                    <i class="fab fa-microsoft"></i>
                    Microsoft
                </a>
            </div>
            
            <div class="auth-footer">
                ¿Ya tienes una cuenta? <a href="../index.html" onclick="goToLogin()">Inicia sesión aquí</a>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let formData = {};
        let validationErrors = {};

        // Función para alternar visibilidad de contraseña
        function togglePassword(inputId, iconId) {
            const passwordInput = document.getElementById(inputId);
            const passwordIcon = document.getElementById(iconId);
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                passwordIcon.className = 'fas fa-eye-slash';
            } else {
                passwordInput.type = 'password';
                passwordIcon.className = 'fas fa-eye';
            }
        }

        // Función para verificar fuerza de contraseña
        function checkPasswordStrength(password) {
            let strength = 0;
            let strengthText = '';
            let color = '';

            const requirements = {
                length: password.length >= 8,
                lowercase: /[a-z]/.test(password),
                uppercase: /[A-Z]/.test(password),
                number: /[0-9]/.test(password),
                special: /[^A-Za-z0-9]/.test(password)
            };

            // Actualizar indicadores visuales de requisitos
            Object.keys(requirements).forEach(req => {
                const element = document.getElementById(`req-${req}`);
                const icon = element.querySelector('i');
                if (requirements[req]) {
                    element.classList.add('met');
                    icon.className = 'fas fa-check';
                    strength++;
                } else {
                    element.classList.remove('met');
                    icon.className = 'fas fa-times';
                }
            });

            // Determinar nivel de fuerza
            switch (strength) {
                case 0:
                case 1:
                    strengthText = 'Muy débil';
                    color = '#ef4444';
                    break;
                case 2:
                    strengthText = 'Débil';
                    color = '#f59e0b';
                    break;
                case 3:
                    strengthText = 'Regular';
                    color = '#eab308';
                    break;
                case 4:
                    strengthText = 'Fuerte';
                    color = '#10b981';
                    break;
                case 5:
                    strengthText = 'Muy fuerte';
                    color = '#059669';
                    break;
            }

            const strengthFill = document.getElementById('strength-fill');
            const strengthTextEl = document.getElementById('strength-text');
            
            strengthFill.style.width = (strength * 20) + '%';
            strengthFill.style.backgroundColor = color;
            strengthTextEl.textContent = strengthText;
            strengthTextEl.style.color = color;

            return strength;
        }

        // Función de validación de email
        function validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // Función de validación de teléfono
        function validatePhone(phone) {
            const phoneRegex = /^[\+]?[1-9][\d]{0,15}$/;
            return !phone || phoneRegex.test(phone.replace(/\s/g, ''));
        }

        // Función para mostrar errores
        function showError(fieldId, message) {
            const field = document.getElementById(fieldId);
            const errorElement = document.getElementById(`${fieldId}-error`);
            
            field.classList.add('error');
            field.classList.remove('success');
            errorElement.textContent = message;
            errorElement.style.display = 'block';
            
            validationErrors[fieldId] = message;
        }

        // Función para mostrar éxito
        function showSuccess(fieldId) {
            const field = document.getElementById(fieldId);
            const errorElement = document.getElementById(`${fieldId}-error`);
            
            field.classList.remove('error');
            field.classList.add('success');
            errorElement.style.display = 'none';
            
            delete validationErrors[fieldId];
        }

        // Función para limpiar errores
        function clearError(fieldId) {
            const field = document.getElementById(fieldId);
            const errorElement = document.getElementById(`${fieldId}-error`);
            
            field.classList.remove('error', 'success');
            errorElement.style.display = 'none';
            
            delete validationErrors[fieldId];
        }

        // Validación en tiempo real
        function setupRealTimeValidation() {
            const fields = ['firstName', 'lastName', 'email', 'phone', 'role', 'password', 'confirmPassword'];
            
            fields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                
                field.addEventListener('blur', function() {
                    validateField(fieldId, this.value);
                });

                field.addEventListener('input', function() {
                    if (validationErrors[fieldId]) {
                        validateField(fieldId, this.value);
                    }
                });
            });
        }

        // Función de validación individual de campos
        function validateField(fieldId, value) {
            switch (fieldId) {
                case 'firstName':
                case 'lastName':
                    if (!value.trim()) {
                        showError(fieldId, 'Este campo es requerido');
                        return false;
                    } else if (value.trim().length < 2) {
                        showError(fieldId, 'Debe tener al menos 2 caracteres');
                        return false;
                    } else {
                        showSuccess(fieldId);
                        return true;
                    }

                case 'email':
                    if (!value.trim()) {
                        showError(fieldId, 'El email es requerido');
                        return false;
                    } else if (!validateEmail(value)) {
                        showError(fieldId, 'Ingresa un email válido');
                        return false;
                    } else {
                        showSuccess(fieldId);
                        return true;
                    }

                case 'phone':
                    if (value && !validatePhone(value)) {
                        showError(fieldId, 'Ingresa un número de teléfono válido');
                        return false;
                    } else {
                        showSuccess(fieldId);
                        return true;
                    }

                case 'role':
                    if (!value) {
                        showError(fieldId, 'Selecciona un rol');
                        return false;
                    } else {
                        showSuccess(fieldId);
                        return true;
                    }

                case 'password':
                    if (!value) {
                        showError(fieldId, 'La contraseña es requerida');
                        return false;
                    } else if (checkPasswordStrength(value) < 3) {
                        showError(fieldId, 'La contraseña debe ser más fuerte');
                        return false;
                    } else {
                        showSuccess(fieldId);
                        // Validar confirmación si ya tiene valor
                        const confirmPassword = document.getElementById('confirmPassword').value;
                        if (confirmPassword) {
                            validateField('confirmPassword', confirmPassword);
                        }
                        return true;
                    }

                case 'confirmPassword':
                    const password = document.getElementById('password').value;
                    if (!value) {
                        showError(fieldId, 'Confirma tu contraseña');
                        return false;
                    } else if (value !== password) {
                        showError(fieldId, 'Las contraseñas no coinciden');
                        return false;
                    } else {
                        showSuccess(fieldId);
                        return true;
                    }

                default:
                    return true;
            }
        }

        // Función para mostrar/ocultar overlay de carga
        function showLoading(show = true) {
            const overlay = document.getElementById('loadingOverlay');
            overlay.style.display = show ? 'flex' : 'none';
        }

        // Función de registro simulado
        async function registerUser(userData) {
            // Simular llamada a API
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    // Simular éxito (90% de probabilidad)
                    if (Math.random() > 0.1) {
                        resolve({
                            success: true,
                            message: 'Usuario registrado exitosamente',
                            user: {
                                id: Math.random().toString(36).substr(2, 9),
                                email: userData.email,
                                name: `${userData.firstName} ${userData.lastName}`,
                                role: userData.role
                            }
                        });
                    } else {
                        reject({
                            success: false,
                            message: 'Error en el servidor. Intenta nuevamente.',
                            errors: {
                                email: 'Este email ya está registrado'
                            }
                        });
                    }
                }, 2000);
            });
        }

        // Función para el login social
        function socialLogin(provider) {
            showLoading(true);
            
            // Simular autenticación social
            setTimeout(() => {
                showLoading(false);
                alert(`Autenticación con ${provider} no está disponible en esta demo`);
            }, 1500);
        }

        // Función para ir al login
        function goToLogin() {
            // En una app real, redirigiría a la página de login
            alert('Redirigiendo al login...');
        }

        // Función para abrir modal de términos/privacidad
        function openModal(type) {
            const content = type === 'terms' ? 
                'Términos de Servicio:\n\n1. Aceptación de términos\n2. Uso del servicio\n3. Privacidad y datos\n4. Responsabilidades del usuario\n5. Limitaciones de responsabilidad' :
                'Política de Privacidad:\n\n1. Información que recopilamos\n2. Cómo usamos la información\n3. Compartir información\n4. Seguridad de datos\n5. Derechos del usuario';
            
            alert(content);
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            setupRealTimeValidation();

            // Mostrar requisitos de contraseña al enfocar
            document.getElementById('password').addEventListener('focus', function() {
                document.getElementById('passwordRequirements').style.display = 'block';
            });

            // Verificar fuerza de contraseña en tiempo real
            document.getElementById('password').addEventListener('input', function(e) {
                checkPasswordStrength(e.target.value);
                if (e.target.value === '') {
                    document.getElementById('passwordRequirements').style.display = 'none';
                }
            });

            // Validar términos y condiciones
            document.getElementById('terms').addEventListener('change', function() {
                if (this.checked) {
                    clearError('terms');
                } else if (validationErrors['terms']) {
                    showError('terms', 'Debes aceptar los términos y condiciones');
                }
            });

            // Manejar envío del formulario
            document.getElementById('registerForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // Recopilar datos del formulario
                const formData = {
                    firstName: document.getElementById('firstName').value.trim(),
                    lastName: document.getElementById('lastName').value.trim(),
                    email: document.getElementById('email').value.trim(),
                    phone: document.getElementById('phone').value.trim(),
                    role: document.getElementById('role').value,
                    password: document.getElementById('password').value,
                    confirmPassword: document.getElementById('confirmPassword').value,
                    terms: document.getElementById('terms').checked
                };
                
                // Validar todos los campos
                let isValid = true;
                
                // Validar campos requeridos
                const requiredFields = ['firstName', 'lastName', 'email', 'role', 'password', 'confirmPassword'];
                requiredFields.forEach(field => {
                    if (!validateField(field, formData[field])) {
                        isValid = false;
                    }
                });

                // Validar teléfono si está presente
                if (formData.phone && !validateField('phone', formData.phone)) {
                    isValid = false;
                }

                // Validar términos
                if (!formData.terms) {
                    showError('terms', 'Debes aceptar los términos y condiciones');
                    isValid = false;
                } else {
                    clearError('terms');
                }

                // Si hay errores, detener el envío
                if (!isValid) {
                    // Enfocar el primer campo con error
                    const firstError = Object.keys(validationErrors)[0];
                    if (firstError) {
                        document.getElementById(firstError).focus();
                    }
                    return;
                }

                // Mostrar indicador de carga
                const submitBtn = document.getElementById('register-btn');
                submitBtn.classList.add('loading');
                submitBtn.disabled = true;

                try {
                    // Intentar registrar usuario
                    const result = await registerUser(formData);
                    
                    // Mostrar mensaje de éxito
                    document.getElementById('successMessage').style.display = 'block';
                    
                    // Limpiar formulario
                    document.getElementById('registerForm').reset();
                    
                    // Limpiar todos los estados de validación
                    const allFields = document.querySelectorAll('.form-input, .form-select');
                    allFields.forEach(field => {
                        field.classList.remove('error', 'success');
                    });
                    
                    const allErrors = document.querySelectorAll('.error-message');
                    allErrors.forEach(error => {
                        error.style.display = 'none';
                    });

                    // Resetear indicadores de contraseña
                    document.getElementById('strength-fill').style.width = '0%';
                    document.getElementById('strength-text').textContent = 'Ingresa una contraseña';
                    document.getElementById('passwordRequirements').style.display = 'none';
                    
                    validationErrors = {};

                    // Simular redirección después de 3 segundos
                    setTimeout(() => {
                        document.getElementById('successMessage').style.display = 'none';
                        goToLogin();
                    }, 3000);

                } catch (error) {
                    // Manejar errores del servidor
                    if (error.errors) {
                        Object.keys(error.errors).forEach(field => {
                            showError(field, error.errors[field]);
                        });
                    } else {
                        alert(error.message || 'Error desconocido. Intenta nuevamente.');
                    }
                } finally {
                    // Ocultar indicador de carga
                    submitBtn.classList.remove('loading');
                    submitBtn.disabled = false;
                }
            });

            // Validación de email único (simulada)
            let emailTimeout;
            document.getElementById('email').addEventListener('input', function(e) {
                const email = e.target.value.trim();
                
                if (emailTimeout) {
                    clearTimeout(emailTimeout);
                }

                if (email && validateEmail(email)) {
                    emailTimeout = setTimeout(() => {
                        // Simular verificación de email único
                        if (email === 'test@example.com') {
                            showError('email', 'Este email ya está registrado');
                        }
                    }, 1000);
                }
            });

            // Animación de entrada mejorada
            const card = document.querySelector('.auth-card');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.animation = 'fadeInUp 0.8s ease-out';
                    }
                });
            });
            observer.observe(card);

            // Efecto de partículas en el fondo (opcional)
            createParticles();
        });

        // Función para crear efecto de partículas
        function createParticles() {
            const particleCount = 20;
            
            for (let i = 0; i < particleCount; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.style.cssText = `
                        position: fixed;
                        width: 4px;
                        height: 4px;
                        background: rgba(255, 255, 255, 0.3);
                        border-radius: 50%;
                        pointer-events: none;
                        z-index: -1;
                        left: ${Math.random() * 100}vw;
                        top: ${Math.random() * 100}vh;
                        animation: float ${15 + Math.random() * 10}s infinite linear;
                    `;
                    
                    document.body.appendChild(particle);
                    
                    // Remover partícula después de la animación
                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    }, 25000);
                }, i * 1000);
            }
        }

        // Añadir animación CSS para las partículas
        const style = document.createElement('style');
        style.textContent = `
            @keyframes float {
                0% {
                    transform: translateY(100vh) rotate(0deg);
                    opacity: 0;
                }
                10% {
                    opacity: 1;
                }
                90% {
                    opacity: 1;
                }
                100% {
                    transform: translateY(-100vh) rotate(360deg);
                    opacity: 0;
                }
            }
            
            .auth-card {
                animation: slideInFromBottom 0.8s cubic-bezier(0.23, 1, 0.32, 1);
            }
            
            @keyframes slideInFromBottom {
                0% {
                    transform: translateY(100px);
                    opacity: 0;
                }
                100% {
                    transform: translateY(0);
                    opacity: 1;
                }
            }
        `;
        document.head.appendChild(style);

        // Función para generar datos de prueba
        function fillTestData() {
            document.getElementById('firstName').value = 'Juan';
            document.getElementById('lastName').value = 'Pérez';
            document.getElementById('email').value = 'juan.perez@email.com';
            document.getElementById('phone').value = '+1234567890';
            document.getElementById('role').value = 'student';
            document.getElementById('password').value = 'TestPassword123!';
            document.getElementById('confirmPassword').value = 'TestPassword123!';
            document.getElementById('terms').checked = true;
            
            // Trigger validations
            ['firstName', 'lastName', 'email', 'phone', 'role', 'password', 'confirmPassword'].forEach(field => {
                validateField(field, document.getElementById(field).value);
            });
            
            checkPasswordStrength('TestPassword123!');
        }

        // Atajos de teclado para desarrollo
        document.addEventListener('keydown', function(e) {
            // Ctrl + Shift + T para llenar datos de prueba
            if (e.ctrlKey && e.shiftKey && e.key === 'T') {
                e.preventDefault();
                fillTestData();
            }
        });

        // Función de limpieza al cerrar/recargar la página
        window.addEventListener('beforeunload', function() {
            // Limpiar timeouts y intervals si los hay
            if (emailTimeout) {
                clearTimeout(emailTimeout);
            }
        });
    </script>
</body>
</html>